<<<<<<< HEAD
function _0x3328(_0x44db31,_0x1295f5){const _0x4ea640=_0x4ea6();return _0x3328=function(_0x33289c,_0x100bed){_0x33289c=_0x33289c-0xf5;let _0x4a6a4e=_0x4ea640[_0x33289c];return _0x4a6a4e;},_0x3328(_0x44db31,_0x1295f5);}const _0x3210ef=_0x3328;function _0x4ea6(){const _0xe9f30e=['14345wFbEEx','then','6952JTyFWk','classList','\x22\x20style=\x22max-width:1.2em;height:auto;vertical-align:','2168306KdkXjL','getElementsByTagName','2299770qKdKnc','2320jHiYcN',';\x22/>','1614QTfXlG','bim2.js','top','script','20XjBSKE','includes','8WbBVyf','bottom','35TkeOHL','catch','span.','/em/bim2.json','src','getAttribute','19780423IxpaWs','bim','querySelectorAll','from','forEach','45880RheWpL','Error\x20loading\x20emoticon\x20data:','12pTCoCB','\x22\x20alt=\x22','textContent','<img\x20src=\x22','trim','innerHTML','74493wJNbsw','sub','baseline','addEventListener','keys','DOMContentLoaded','startsWith'];_0x4ea6=function(){return _0xe9f30e;};return _0x4ea6();}(function(_0x384e1f,_0x2791ff){const _0x52fb3e=_0x3328,_0xb5ee94=_0x384e1f();while(!![]){try{const _0x3686d5=parseInt(_0x52fb3e(0x108))/0x1*(-parseInt(_0x52fb3e(0x113))/0x2)+-parseInt(_0x52fb3e(0x11b))/0x3*(-parseInt(_0x52fb3e(0x104))/0x4)+parseInt(_0x52fb3e(0xf6))/0x5*(-parseInt(_0x52fb3e(0x100))/0x6)+-parseInt(_0x52fb3e(0xfb))/0x7*(-parseInt(_0x52fb3e(0x106))/0x8)+parseInt(_0x52fb3e(0xfd))/0x9+-parseInt(_0x52fb3e(0xfe))/0xa*(parseInt(_0x52fb3e(0xf8))/0xb)+-parseInt(_0x52fb3e(0x115))/0xc*(-parseInt(_0x52fb3e(0x10e))/0xd);if(_0x3686d5===_0x2791ff)break;else _0xb5ee94['push'](_0xb5ee94['shift']());}catch(_0x26d213){_0xb5ee94['push'](_0xb5ee94['shift']());}}}(_0x4ea6,0x77901),document[_0x3210ef(0x11e)](_0x3210ef(0x120),function(){const _0x1c5e59=_0x3210ef,_0x164100=document[_0x1c5e59(0xfc)](_0x1c5e59(0x103));let _0x2a9ac3='';for(let _0x51a034=0x0;_0x51a034<_0x164100['length'];_0x51a034++){const _0xdd6e3e=_0x164100[_0x51a034][_0x1c5e59(0x10d)](_0x1c5e59(0x10c));if(_0xdd6e3e&&_0xdd6e3e[_0x1c5e59(0x105)](_0x1c5e59(0x101))){_0x2a9ac3=_0xdd6e3e['split']('/')['slice'](0x0,-0x1)['join']('/');break;}}const _0x5c0194=_0x2a9ac3+_0x1c5e59(0x10b);fetch(_0x5c0194)['then'](_0x335ff3=>_0x335ff3['json']())[_0x1c5e59(0xf7)](_0x222ac4=>{const _0x48b4a2=_0x1c5e59;Object[_0x48b4a2(0x11f)](_0x222ac4)[_0x48b4a2(0x112)](_0x5030ce=>{const _0x2a2cf9=_0x48b4a2,_0x1265dc=_0x222ac4[_0x5030ce],_0x48d001=_0x1265dc['path'],_0x249dce=_0x1265dc['bimt'],_0x40873f=_0x1265dc['bims'];typeof _0x1265dc==='object'&&_0x1265dc!==null&&document[_0x2a2cf9(0x110)](_0x2a2cf9(0x10a)+_0x5030ce+',\x20i.'+_0x5030ce)[_0x2a2cf9(0x112)](_0x2e0a96=>{const _0x1cb1da=_0x2a2cf9,_0x3e7e7a=_0x2e0a96[_0x1cb1da(0x117)][_0x1cb1da(0x119)](),_0x43c8a9=_0x249dce['indexOf'](_0x3e7e7a);if(_0x43c8a9!==-0x1){const _0x2c382f=_0x40873f[_0x43c8a9],_0x5f22eb={'bim':'middle','bim-t':_0x1cb1da(0x102),'bim-b':_0x1cb1da(0x11d),'bim-m':_0x1cb1da(0x107),'bim-s':_0x1cb1da(0x11c)}[Array[_0x1cb1da(0x111)](_0x2e0a96[_0x1cb1da(0xf9)])['find'](_0x210bfc=>_0x210bfc[_0x1cb1da(0xf5)](_0x1cb1da(0x10f)))]||'',_0x3134e3=''+_0x2a9ac3+_0x48d001+_0x2c382f+'.png';_0x2e0a96[_0x1cb1da(0x11a)]=_0x1cb1da(0x118)+_0x3134e3+_0x1cb1da(0x116)+_0x3e7e7a+_0x1cb1da(0xfa)+_0x5f22eb+_0x1cb1da(0xff);}});});})[_0x1c5e59(0x109)](_0x1e8658=>console['error'](_0x1c5e59(0x114),_0x1e8658));}));
=======
document.addEventListener('DOMContentLoaded', function() {
    // 获取当前脚本的 URL 前缀
    const scriptElements = document.getElementsByTagName('script');
    let scriptUrl = '';

    // 查找引用当前脚本的 <script> 标签
    for (let i = 0; i < scriptElements.length; i++) {
        const src = scriptElements[i].getAttribute('src');
        if (src && src.includes('bim2.js')) { // 确保根据文件名匹配
            scriptUrl = src.split('/').slice(0, -1).join('/'); // 获取前缀路径
            break;
        }
    }

    // 拼接完整的 JSON 请求 URL
    const jsonUrl = `${scriptUrl}/em/bim2.json`;

    fetch(jsonUrl)
        .then(response => response.json())
        .then(data => {
            // 遍历 JSON 对象中的每一个键
            Object.keys(data).forEach(key => {
                const keyData = data[key];
                const path = keyData.path;
                const bimt = keyData.bimt;
                const bims = keyData.bims;

                // 确保数据项是对象，并且有值
                if (typeof keyData === 'object' && keyData !== null) {
                    // 选择所有带有 class 中包含 bim 的 span 或 i 元素
                    document.querySelectorAll(`span.${key}, i.${key}`).forEach(element => {
                        const elementText = element.textContent.trim();
                        // 检查文本是否在 bimt 数组中
                        const index = bimt.indexOf(elementText);
                        if (index !== -1) {
                            const bimi = bims[index];
                            const alignmentClass = {
                                'bim': 'middle',
                                'bim-t': 'top',
                                'bim-b': 'baseline',
                                'bim-m': 'bottom',
                                'bim-s': 'sub'
                            }[Array.from(element.classList).find(cls => cls.startsWith('bim'))] || '';

                            // 拼接完整的图片 URL
                            const bimg = `${scriptUrl}${path}${bimi}.png`;

                            // 更新元素的 HTML
                            element.innerHTML = `<img src="${bimg}" alt="${elementText}" style="max-width:1.2em;height:auto;vertical-align:${alignmentClass};"/>`;
                        }
                    });
                }
            });
        })
        .catch(error => console.error('Error loading emoticon data:', error));
});
>>>>>>> branch 'master' of https://github.com/wbgxpw/bimoji.git
